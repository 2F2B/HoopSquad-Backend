generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Alarm {
  Alarm_id  Int     @id @default(autoincrement())
  User_id   Int
  UserImage Bytes?  @db.Blob
  Text      String  @db.VarChar(200)
  IsRead    Boolean @default(false)
  IsApply   Int?
  User      User    @relation(fields: [User_id], references: [User_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_Alarm_User")

  @@index([User_id], map: "User_idx")
}

model ChatRelay {
  Room_id  Int      @id
  User_id  Int
  ChatRoom ChatRoom @relation(fields: [Room_id], references: [Room_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ChatRelay_ChatRoom")
  User     User     @relation(fields: [User_id], references: [User_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_ChatRelay_User")

  @@index([Room_id], map: "Room_idx")
  @@index([User_id], map: "fk_ChatRelay_User")
}

model ChatRoom {
  Room_id   Int        @id @default(autoincrement())
  Host_id   Int
  Guest_id  Int
  Time      DateTime   @default(now()) @db.Timestamp(0)
  ChatRelay ChatRelay?
  Message   Message[]
}

model Court {
  Court_id Int      @default(autoincrement())
  Name     String   @db.VarChar(45)
  Date     DateTime @default(now()) @db.Timestamp(0)
  Location String   @db.VarChar(100)
  Map_id   Int
  Map      Map      @relation(fields: [Map_id], references: [Map_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_Court_Map")

  @@id([Court_id, Map_id])
  @@index([Map_id], map: "Map_idx")
}

model Map {
  Map_id       Int       @id @default(autoincrement())
  LocationName String?    @db.VarChar(45)
  Lat          Float     @db.Float
  Lng          Float     @db.Float
  Court        Court[]
  Posting      Posting[]
}

model Message {
  Message_id  Int      @id @default(autoincrement())
  Room_id     Int
  Msg         String   @db.LongText
  ChatTime    DateTime @default(now()) @db.Timestamp(0) 
  Writer_id   String   @db.VarChar(45)
  Receiver_id String   @db.VarChar(45)
  ChatRoom    ChatRoom @relation(fields: [Room_id], references: [Room_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_Message_ChatRoom")

  @@index([Room_id], map: "Room_idx")
}

model OAuthToken {
  id               Int    @id @default(autoincrement())
  User_id          Int
  AccessToken      String @db.VarChar(255)
  RefreshToken     String @db.VarChar(255)
  AToken_CreatedAt String @db.VarChar(20)
  RToken_CreatedAt String @db.VarChar(20)
  AToken_Expires   Int
  RToken_Expires   Int
  Auth_id          String @db.VarChar(40)
  User             User   @relation(fields: [User_id], references: [User_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_OAuthToken_User")

  @@index([User_id], map: "Personal_idx")
}

model Posting {
  Posting_id    Int      @id @default(autoincrement())
  User_id       Int
  IsTeam        Boolean  @default(false)
  Title         String   @db.VarChar(100)
  WriteDate     DateTime @default(now()) @db.Timestamp(0)
  PlayTime      String   @db.VarChar(45)
  Location      String   @db.VarChar(45)
  RecruitAmount String   @db.VarChar(45)
  CurrentAmount String   @db.VarChar(45)
  Introduce     String?  @db.VarChar(600)
  Map_id        Int
  GameType      String   @db.VarChar(10)
  Image_id      Int?
  Map           Map     @relation(fields: [Map_id], references: [Map_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_Posting_Map")
  User          User     @relation(fields: [User_id], references: [User_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_Posting_User")
  Image         Image?   @relation(fields: [Image_id], references: [Image_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_posting_image")

  @@index([User_id], map: "Writer_idx")
  @@index([Map_id], map: "fk_Posting_Map1_idx")
  @@index([Image_id], map: "fk_posting_image")
}

model Profile {
  User_id   Int     @id
  Height    Float?  @db.Float
  Age       Int?
  Position  String? @db.VarChar(45)
  Grade     String? @db.VarChar(45)
  GameType  Int?
  Introduce String? @db.VarChar(45)
  Location  String? @db.VarChar(45)
  Image_id  Int?
  User      User    @relation(fields: [User_id], references: [User_id], onDelete: Cascade, onUpdate: NoAction)
  Image     Image?  @relation(fields: [Image_id], references: [Image_id], onDelete: Restrict, onUpdate: Restrict, map: "fk_profile_image")

  @@index([Image_id], map: "fk_profile_image")
}

model Review {
  User_id Int     @id @default(autoincrement())
  Fouls   Boolean
  Review  String? @db.VarChar(100)
  User    User    @relation(fields: [User_id], references: [User_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_Review_User")
}

model TeamProfile {
  Team_id    Int        @id @default(autoincrement())
  Admin_id   Int
  Name       String     @db.VarChar(45)
  TeamImage  Bytes?     @db.Blob
  Location   String     @db.VarChar(45)
  Introduce  String?    @db.VarChar(400)
  LatestDate DateTime?  @db.DateTime(0)
  UserAmount Int?
  User       User       @relation(fields: [Admin_id], references: [User_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_TeamProfile_Admin")
  TeamRelay  TeamRelay?

  @@index([Admin_id], map: "fk_TeamProfile_UserProfile1_idx")
}

model TeamRelay {
  Team_id     Int         @id
  IsAdmin     Boolean
  User_id     Int
  User        User        @relation(fields: [User_id], references: [User_id], onDelete: NoAction, onUpdate: NoAction)
  TeamProfile TeamProfile @relation(fields: [Team_id], references: [Team_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_TeamRelay_TeamProfile")

  @@index([Team_id], map: "fk_TeamRelay_TeamProfile")
  @@index([User_id], map: "TeamRelay_User_id_fkey")
}

model User {
  User_id     Int           @id @default(autoincrement())
  Name        String        @db.VarChar(45)
  Alarm       Alarm[]
  ChatRelay   ChatRelay[]
  OAuthToken  OAuthToken[]
  Posting     Posting[]
  Profile     Profile?
  Review      Review?
  TeamProfile TeamProfile[]
  TeamRelay   TeamRelay[]
}

model Image {
  Image_id  Int       @id @default(autoincrement())
  ImageData Bytes     @db.Blob
  Posting   Posting[]
  Profile   Profile[]
}
